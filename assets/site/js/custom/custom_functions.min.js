/*!
 * JavaScript
 *Saad Khan
 */
$(function () {
    setTimeout(function () {
        $(".alertMessages, .alertMessage, #formErrorMsg, #formErrorMsgContact").stop(true, true).hide(500)
    }, 5000)
});
$(function () {
    $("#contactus_form, #signupForm, #loginForm, #ForgotPasswordForm, #users_form, #form_listings").validate({
        errorElement: "div",
        errorClass: "help-block",
        focusInvalid: true,
        highlight: function (a) {
            $(a).closest(".form-group").removeClass("has-info").addClass("has-error")
        },
        success: function (a) {
            $(a).closest(".form-group").removeClass("has-error");
            $(a).remove()
        },
        errorPlacement: function (b, c) {
            if (c.is("input[type=checkbox]") || c.is("input[type=radio]")) {
                var a = c.closest('div[class*="col-"]');
                if (a.find(":checkbox,:radio").length > 1) {
                    a.append(b)
                } else {
                    b.insertAfter(c.nextAll(".lbl:eq(0)").eq(0))
                }
            } else {
                if (c.is(".select2")) {
                    b.insertAfter(c.siblings('[class*="select2-container"]:eq(0)'))
                } else {
                    if (c.is(".chosen-select")) {
                        b.insertAfter(c.siblings('[class*="chosen-container"]:eq(0)'))
                    } else {
                        b.insertAfter(c.parent())
                    }
                }
            }
        },
        invalidHandler: function (a) {}
    })
    $("#password_form").validate({
        rules: {
            password: {
                required: true,
                minlength: 6
            },
            new_password: {required: true,
                minlength: 6

            },
            confirm_password: {
                required: true,
                minlength: 6,
                equalTo: "#new_password"
            },
        },
        messages: {
            password: {required: "Password is required",
                minlength: "Password must be 6 characters minimum",
            },
            new_password: {required: "New Password is required",
                minlength: "New Password must be 6 characters minimum",
            },
            confirm_password: {required: "Confirm Password is required",
                minlength: "Confirm Password must be 6 characters minimum",
                equalTo: "Please enter same password as enter above"
            }

        },
        highlight: function (element) {
            $(element).parent().css({"color": "red", "font-size": "0.9em", "font-weight": "normal"});
        }
    });
});



function checkEmail() {
    $("#emailExist_error").hide();
    var b = "";
    if (!isValidEmailAddress($("#email").val())) {
        b = "The email address contains illegal characters. Please enter correct email.";
        showMessage("alert-danger", "formErrorMsg", b);
        $("#email").focus();
        $("#email").val("");
        return false
    }
    if ($("#email").valid()) {
        var a = BASE_URL + "register/checkEmail";
        $.ajax({
            type: "POST",
            url: a,
            dataType: "html",
            data: {
                email: $("#email").val()
            },
            success: function (c) {
                if (c == 1) {
                    $("#emailExist_error").html("Email already exists... Try another one.");
                    $("#emailExist_error").show();
                    $("#email").val("");
                    return false
                } else {
                    return true
                }
            },
            error: function () {
                alert(ajax_alert)
            }
        })
    }
}

function loginUserVarify() {
    if ($("#formLoginPopup").valid()) {
        $("#submitLogin").prop("disabled", true);
        var a = BASE_URL + "login/ajaxLoginPopUp";
        var b = $("#formLoginPopup").serialize();
        $.ajax({
            type: "POST",
            url: a,
            data: b,
            dataType: "json",
            success: function (c) {
                $("#submitLogin").prop("disabled", false);
                if (c.action == "error") {
                    showMessage("alert-danger", "formErrorMsgPopupLogin", c.message)
                } else {
                    showMessage("alert-success", "formErrorMsgPopupLogin", c.message);
                    clear_form_elements("#formLoginPopup");
                    setTimeout(function () {
                        window.location.href = window.location
                    }, 1000)
                }
            },
            error: function () {
                alert(ajax_alert)
            }
        })
    }
}

function formPostsComments() {
    var c = "";
    if ($("#comment").val() == "") {
        c = "Please enter comment";
        showMessage("alert-danger", "formErrorMsg", c);
        $("#comment").focus();
        return false
    }
    if ($("#commentsCounter").val() == 0) {
        $("#newComnt").html("")
    }
    $("#newComnt").prepend('<div class="us-op"><img src="' + $("#member_photo").val() + '" alt="' + $("#login_user_name").val() + '" class="" /><div class="pull-left comentDiv"><span>' + $("#login_user_name").val() + '</span><small class="pull-right">few second ago</small><p class="cmnt-head-area-cntnt">' + $("#comment").val() + '</p></div><div class="clearfix"></div></div>');
    var a = BASE_URL + "blog/ajaxSave";
    var b = $("#formPostsComments").serialize() + "&post_id=" + $("#post_id").val();
    $.ajax({
        type: "POST",
        url: a,
        data: b,
        dataType: "html",
        success: function (d) {
            showMessage("alert-success", "formErrorMsg", d);
            clear_form_elements("#formPostsComments")
        },
        error: function () {
            alert("Error occured during Ajax request...")
        }
    })
}

function like(b) {
    if ($("#login_user_id").val() == "" || LOGIN_USER_ID == 0) {
        $("#loginBtnForm").click();
        return false
    } else {
        var a = "";
        if ($("#like_countr_" + b).text() == "") {
            a = 0
        } else {
            a = $("#like_countr_" + b).text()
        }
        $("#like_countr_" + b).text((parseInt(a) + 1));
        $("#" + b + "_like").removeAttr("onclick");
        $("#" + b + "_like").addClass("already_liked");
        $("#" + b + "_like").attr("onclick", "dislike('" + b + "','" + b + "')");
        $.ajax({
            type: "POST",
            global: false,
            url: BASE_URL + "blog/like",
            data: "id=" + b,
            success: function (c) {}
        })
    }
}

function dislike(b) {
    if ($("#login_user_id").val() == "" || LOGIN_USER_ID == 0) {
        $("#loginBtnForm").click();
        return false
    } else {
        var a = "";
        if ($("#like_countr_" + b).text() == "") {
            a = 0
        } else {
            a = $("#like_countr_" + b).text()
        }
        $("#like_countr_" + b).text((parseInt(a) - 1));
        $("#" + b + "_like").removeAttr("onclick");
        $("#" + b + "_like").removeClass("already_liked");
        $("#" + b + "_like").attr("onclick", "like('" + b + "','" + b + "')");
        $.ajax({
            type: "POST",
            global: false,
            url: BASE_URL + "blog/dislike",
            data: "id=" + b,
            success: function (c) {}
        })
    }
}

// function shareLinkCopy(b, a) {
//     $("#sharedLink").html($("#proLink" + b).val());
//     if (b) {
//         $.ajax({
//             type: "POST",
//             global: false,
//             url: BASE_URL + "marketing/shareLinkCopy",
//             data: {
//                 id: b,
//                 link: $("#proLink" + b).val(),
//                 type: a
//             },
//             success: function (c) {}
//         })
//     }
// }

function varfyPaypalEmail() {
    $("#paypal_error").hide();
    var b = "";
    if (!isValidEmailAddress($("#paypal_email").val())) {
        b = "The email address contains illegal characters. Please enter correct email.";
        showMessage("alert-danger", "paypal_error", b);
        $("#paypal_email").focus();
        $("#paypal_email").val("");
        return false;
    }
    if ($("#paypal_email").valid()) {
        var a = BASE_URL + "dashboard/varfyPaypalEmail";
        $.ajax({
            type: "POST",
            url: a,
            dataType: "html",
            data: {
                paypal_email: $("#paypal_email").val(),paypal_first_name: $("#paypal_first_name").val(),paypal_last_name: $("#paypal_last_name").val()
            },
            success: function (c) {
                if (c == 0) {
                    $("#paypal_error").html("PayPal email not verified. Please enter correct email.");
                    $("#paypal_error").show();
                    $("#paypal_email").val("");
                    return false
                } else {
                    $("#paypal_error").html("PayPal email verified successfully.");
                    $("#paypal_error").show();
                    return true
                }
            },
            error: function () {
                alert(ajax_alert)
            }
        })
    }
}

function parent_category1(e, d) {
    var c;
    c = d;
    c = c + 1;
    var b = ($("#form_listings .catClass").size() + 2);
    for (i = c; i <= b; i++) {
        $(".subCat_" + i).remove()
    }
    if ($("#" + e).val() == 0 || $("#" + e).val() == "") {
        return false
    } else {
        var a = BASE_URL + "products/getSubCategory";
        $.ajax({
            type: "POST",
            url: a,
            data: "category_id=" + $("#" + e).val() + "&level=" + d,
            dataType: "json",
            success: function (f) {
                d++;
                var g = "";
                if (f.result_counter == 0) {
                    $(".subCat_" + (d++)).remove()
                } else {
                    $(".subCat_" + d).remove();
                    g = '<div class="form-group subCat_' + d + '"><label class="col-md-3 control-label">' + f.label + '</label><div class="col-xs-12 col-sm-6"><div class="clearfix"><select id="category_' + d + '" name="category_id[]"  class="form-control catClass" onchange="parent_category1(\'category_' + d + "'," + d + ')"><option value="">Select</option>';
                    $.each(f.result, function () {
                        g = g + '<option value="' + this.category_id + '">' + this.category_name + "</option>"
                    });
                    g = g + "</select></div></div></div>"
                }
                $(".subCat_" + (--d)).after(g);
                $("#inc").val($("#form_listings > .catClass").size());
                var h = $(".catClass option:selected").map(function () {
                    if ($(this).val() == 0) {
                    } else {
                        return $(this).val()
                    }
                }).get().join(",");
                $("#sub_parent").val(h)
            }
        })
    }
}

function checkUsersEmail() {
    $("#emailExist_error").hide();
    var b = "";
    if (!isValidEmailAddress($("#email").val())) {
        b = "The email address contains illegal characters. Please enter correct email.";
        showMessage1("alert-danger", "emailExist_error", b);
        $("#email").focus();
        $("#email").val("");
        return false
    }
    if ($("#email").valid()) {
        var a = BASE_URL + "dashboard/checkEmail";
        $.ajax({
            type: "POST",
            url: a,
            dataType: "html",
            data: {
                email: $("#email").val()
            },
            success: function (c) {
                if (c == 1) {
                    b = "Email already exists... Try another one.";
                    showMessage1("alert-danger", "emailExist_error", b);
                    $("#email").focus();
                    $("#email").val("");
                    return false
                } else {
                    return true
                }
            },
            error: function () {
                alert(ajax_alert)
            }
        })
    }
}

function delete_image(b, c) {
    URL = BASE_URL + "products/delete_image";
    var a = confirm("Are you sure you want to delete this image?") ? !0 : !1;
    if (a) {
        $.ajax({
            type: "POST",
            url: URL,
            data: "image_id=" + c + "&image=" + b,
            success: function (d) {
                $("#imagesCount").val($("#imagesCount").val() - 1);
                $("#image_" + c).remove()
            }
        })
    }
}

function remove_uploaded_file(a, b) {
    URL = BASE_URL + "products/remove_uploaded_file";
    $.ajax({
        type: "POST",
        url: URL,
        data: "image_name=" + a + "&id=" + b,
        success: function (c) {
            $("#img_" + b).remove();
            var d = $(".image_ids").map(function () {
                return $(this).val()
            }).get().join(",");
            $("#image_ids").val(d)
        }
    })
};

function updateAffiliateStatus(context, order_id)
    {
        var is_confirmed = $(context).is(':checked');
        $.ajax({
            url: BASE_URL+'products/changeAffiliateStatus',
            type: "post",
            data: {
                s_order_id: order_id , s_is_confirmed : is_confirmed
            },
            success: function (response) {
                response = JSON.parse(response);
                if (response.status == true)
                {
                    
                } 
                else
                {
                    
                }
            },
            error: function (jqXHR, textStatus, errorThrown) {
                console.log(textStatus, errorThrown);
            }
        });
    }
 function shareLinkCopy(b, a ,_url,_open_popup = true) {

        $.post(BASE_URL + "marketing/get_bitly_url", {
            url: _url
        },
        function(url) {
            if(_open_popup)
            {
                $("#sharedLink").html(url);
            $('#copyLinkModal').modal('show');
            }
            

        });
    
   
        if (b) {
            $.ajax({
                type: "POST",
                global: false,
                url: BASE_URL + "marketing/shareLinkCopy",
                data: {
                    id: b,
                    link: _url,
                    type: a
                },
                success: function (c) {}
            })
        }
}

//     function shareLinkCopy(b, a ,_url) {

//         $.post(BASE_URL + "marketing/get_bitly_url", {
//             url: _url
//         },
//         function(url) {

//             $("#sharedLink").html(url);
//             $('#copyLinkModal').modal('show');

//         });
    
   
//         if (b) {
//             $.ajax({
//                 type: "POST",
//                 global: false,
//                 url: BASE_URL + "marketing/shareLinkCopy",
//                 data: {
//                     id: b,
//                     link: _url,
//                     type: a
//                 },
//                 success: function (c) {}
//             })
//         }
// }